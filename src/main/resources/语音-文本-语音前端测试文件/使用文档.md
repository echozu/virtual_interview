Read file: websocket-audio-test.html
以下是 WebSocket 音频流测试工具（讯飞ASR+TTS版）前后端/安卓调用文档，适用于前端和安卓开发者：

---

## 1. 使用流程说明

### 1.1 参数准备

- **WebSocket URL**：后端 WebSocket 服务地址（如：`ws://localhost:9527/ws/interview`，注意协议为 `ws://` 或 `wss://`）。
- **JWT Token**：用户身份认证的 JWT 字符串，需后端颁发。
- **用户ID**：当前用户的唯一标识（如：`1`）。
- **会话ID (sessionId)**：本次会话的唯一标识（如：`1-10-1751005261429`）。

### 1.2 操作步骤

1. **填写参数**  
   在页面左侧依次填写 WebSocket URL、JWT Token、用户ID、会话ID。

2. **连接 WebSocket**  
   点击“连接”按钮，等待状态变为“已连接”。

3. **录音与发送音频流**  
   - 点击“开始录音并发送音频流”按钮，浏览器会请求麦克风权限，开始采集音频并实时发送到后端。
   - 录音过程中可随时点击“停止录音”按钮，结束音频采集与发送。

4. **下载录音**  
   录音结束后，“下载录音为WAV”按钮可用，点击即可下载本次录音的WAV文件。

5. **消息与音频播放**  
   - “消息记录”区会实时显示用户转写、AI转写、音频流等消息。
   - “停止AI语音播放”“清空音频队列”可控制AI语音播放。

---

## 2. 前后端/安卓调用协议文档

### 2.1 WebSocket 连接

- **地址**：`ws(s)://<host>:<port>/ws/interview`
- **认证**：连接时需在 STOMP `connectHeaders` 里带上 `Authorization: Bearer <JWT Token>`

### 2.2 音频流上传（前端/安卓 -> 服务端）

- **发送地址**：`/api/interview/process/audio/tts/{sessionId}`
- **消息格式**（JSON）：

```json
{
  "audio": "<Base64编码的PCM音频数据>"
}
```
- **音频格式**：单声道 16kHz 16bit PCM，建议每40ms发送一次，单包不超过1280字节。

- **结束信号**：录音结束后，发送空body到 `/api/interview/process/audio/end/{sessionId}`，同样带认证头。

### 2.3 实时文本转写（服务端 -> 前端/安卓）

#### 2.3.1 用户实时转写

- **订阅地址**：`/user/queue/interview/transcript.user`
- **消息格式**：

```json
{
  "role": "user",
  "content": "用户说的话的转写文本"
}
```

#### 2.3.2 AI实时回复

- **订阅地址**：`/user/queue/interview/transcript.assistant`
- **消息格式**：

```json
{
  "role": "assistant",
  "content": "AI回复的文本"
}
```

### 2.4 AI音频流下行（服务端 -> 前端/安卓）

- **订阅地址**：`/user/queue/interview/audio.reply`
- **消息格式**：

```json
{
  "audio": "<Base64编码的MP3音频数据块>",
  "isFinal": false
}
```
- **说明**：`isFinal=true` 表示本轮AI语音流已全部发送完毕。

---

## 3. 前端/安卓集成建议

- **WebSocket/STOMP库**：推荐使用 [stomp.js](https://stomp-js.github.io/)（Web）、[Java STOMP客户端](https://github.com/stomp-js/stomp-websocket) 或安卓支持的WebSocket库。
- **音频采集**：安卓需采集16kHz单声道PCM，分包Base64编码后发送。
- **消息处理**：收到转写/AI回复/音频流后，按上述格式解析并展示或播放。

---

## 4. 示例

### 4.1 发送音频流（伪代码）

```java
// 安卓端采集PCM后
byte[] pcmChunk = ...; // 40ms PCM数据
String base64Audio = Base64.encodeToString(pcmChunk, Base64.NO_WRAP);
String json = "{\"audio\":\"" + base64Audio + "\"}";
stompClient.send("/api/interview/process/audio/tts/" + sessionId, headers, json);
```

### 4.2 订阅文本转写

```java
stompClient.subscribe("/user/queue/interview/transcript.user", message -> {
    // message.body: {"role":"user","content":"..."}
});
stompClient.subscribe("/user/queue/interview/transcript.assistant", message -> {
    // message.body: {"role":"assistant","content":"..."}
});
```

### 4.3 订阅AI音频流

```java
stompClient.subscribe("/user/queue/interview/audio.reply", message -> {
    // message.body: {"audio":"...","isFinal":false}
    // 解码Base64后播放MP3
});
```

---

如需更详细的安卓代码样例或遇到具体集成问题，请随时补充说明！